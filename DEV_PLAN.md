# AI-CRM Serverless 重构项目开发计划

> **项目管理规格文档** | 版本 1.0 | 更新日期：2024-11-06

---

## 📋 执行摘要

### 项目定位
基于既有文档集（`docs/technical/`）进行 AI-CRM 系统的 Serverless 化重构，实现 100% 业务功能复刻，并满足云原生架构的性能、安全与可维护性要求。

### 关键成果物
- ✅ 完整的后端 Serverless API（Vercel Functions）
- ✅ 类型安全的数据访问层（Prisma ORM + Postgres）
- ✅ 响应式前端界面（静态托管 + API 对接）
- ✅ 自动化测试覆盖（单元/集成/E2E）
- ✅ 生产级部署配置（监控、日志、备份）

### 工期与资源
- **总工期**：8 周（56 工作日）
- **人力投入**：AI Agent 主导开发，1 名 PM 审批验收
- **关键里程碑**：7 个 Phase，每 Phase 独立验收

---

## 1. 项目概览

### 1.1 项目目标

| 维度 | 目标 | 衡量标准 |
| --- | --- | --- |
| **业务完整性** | 100% 复刻原有功能（认证、客户、回访、订单、仪表盘、预设、设置） | 所有功能接口通过验收测试 |
| **技术现代化** | Serverless 架构，托管数据库，静态前端 | Vercel 部署成功，API 响应时间 < 500ms |
| **代码质量** | 类型安全、模块化、可测试 | 测试覆盖率 ≥ 80%，ESLint 0 错误 |
| **用户体验** | 响应式 UI、深色模式、Lighthouse ≥ 90 | UI Review 通过，E2E 测试无阻塞 |
| **运维能力** | 日志追踪、监控告警、备份恢复 | 生产运行 7 天无 P0/P1 缺陷 |

### 1.2 项目范围

#### ✅ 在范围内
- 后端 API 重构（`/api/*` 全部接口）
- 数据库迁移（SQLite → Postgres）
- 前端静态页面实现与 API 对接
- 认证、授权、限流、日志
- 预设数据管理、仪表盘统计、提醒算法
- 备份/恢复/清空数据功能
- Vercel 部署与监控配置

#### ❌ 不在范围内
- 第三方 CRM/ERP 集成
- 多租户架构（单组织版本）
- 移动端原生 App
- 完整 SPA 框架重写（保持静态 HTML）
- 商业推广与市场活动

### 1.3 项目干系人

| 角色 | 姓名/职责 | 主要职责 | 交付物审批 |
| --- | --- | --- | --- |
| **项目委托人** | PM（您） | 需求确认、计划审批、最终验收 | 所有 Phase 验收、最终签署 |
| **技术负责人** | AI Agent | 架构设计、任务执行、质量保证 | 代码、测试报告、部署文档 |
| **开发工程师** | AI Agent | 后端/前端/数据库/测试实现 | 功能模块、测试套件 |
| **DevOps** | AI Agent | 环境搭建、部署自动化、监控 | 部署脚本、监控配置 |

---

## 2. 项目计划

### 2.1 总体时间表

| 阶段 | 周次 | 开始日期 | 结束日期 | 关键里程碑 | 验收点 |
| --- | --- | --- | --- | --- | --- |
| **Phase 0** | Week 1 | Day 1 | Day 7 | 环境搭建完成 | ✅ Healthcheck 通过 |
| **Phase 1** | Week 2-3 | Day 8 | Day 21 | 认证与客户 API | ✅ 单元测试通过 |
| **Phase 2** | Week 4 | Day 22 | Day 28 | 回访与订单模块 | ✅ 集成测试通过 |
| **Phase 3** | Week 5 | Day 29 | Day 35 | 仪表盘与提醒 | ✅ 统计数据准确 |
| **Phase 4** | Week 6 | Day 36 | Day 42 | 预设数据管理 | ✅ CRUD 与排序验证 |
| **Phase 5** | Week 6-7 | Day 36 | Day 49 | 用户设置与维护 | ✅ 备份恢复功能验证 |
| **Phase 6** | Week 7-8 | Day 43 | Day 56 | 前端对接与优化 | ✅ E2E 测试通过 |
| **Phase 7** | Week 8 | Day 50 | Day 56 | 部署与发布 | ✅ 生产运行 7 天验证 |

> **注**：Phase 4-5 和 Phase 6-7 部分并行执行，以优化工期。

### 2.2 详细任务分解（WBS）

#### Phase 0：项目初始化（Day 1-7）

| 任务 ID | 任务名称 | 工作量 | 依赖 | 负责人 | 交付物 |
| --- | --- | --- | --- | --- | --- |
| WBS-0.1 | 创建项目目录结构 | 0.5d | - | AI | `/api`, `/app`, `/prisma`, `/tests` |
| WBS-0.2 | 安装核心依赖 | 0.5d | WBS-0.1 | AI | `package.json` with deps |
| WBS-0.3 | Prisma Schema 设计 | 2d | WBS-0.2 | AI | `schema.prisma` |
| WBS-0.4 | 数据库迁移与 Seed | 1d | WBS-0.3 | AI | 初始迁移文件、种子数据 |
| WBS-0.5 | Vercel 配置 | 0.5d | WBS-0.2 | AI | `vercel.json`, `.env.local` |
| WBS-0.6 | Healthcheck 接口 | 0.5d | WBS-0.5 | AI | `api/health.ts` |
| WBS-0.7 | 环境验证与文档 | 1d | WBS-0.6 | AI | 初始化文档、验证报告 |

**验收标准（DoD）**：
- [ ] `vercel dev` 启动无错误
- [ ] `GET /api/health` 返回 `{"status": "ok"}`
- [ ] Prisma Studio 可查看数据库
- [ ] 种子数据插入成功（管理员账户 + 预设数据）

---

#### Phase 1：认证与客户模块（Day 8-21）

| 任务 ID | 任务名称 | 工作量 | 依赖 | 负责人 | 交付物 |
| --- | --- | --- | --- | --- | --- |
| WBS-1.1 | JWT 工具实现 | 1d | WBS-0.7 | AI | `utils/jwt.ts` |
| WBS-1.2 | 中间件（Auth/RateLimit/Validation） | 2d | WBS-1.1 | AI | `utils/middleware.ts` |
| WBS-1.3 | 登录接口 | 1d | WBS-1.2 | AI | `api/auth/login.ts` |
| WBS-1.4 | 刷新 Token 接口 | 0.5d | WBS-1.3 | AI | `api/auth/refresh.ts` |
| WBS-1.5 | 客户 CRUD（列表、创建） | 2d | WBS-1.2 | AI | `api/customers/index.ts` |
| WBS-1.6 | 客户 CRUD（详情、更新、删除） | 1.5d | WBS-1.5 | AI | `api/customers/[id].ts` |
| WBS-1.7 | 客户搜索与过滤 | 1d | WBS-1.6 | AI | 查询参数实现 |
| WBS-1.8 | 单元测试（认证） | 1d | WBS-1.4 | AI | `tests/api/auth.test.ts` |
| WBS-1.9 | 单元测试（客户） | 2d | WBS-1.7 | AI | `tests/api/customers.test.ts` |
| WBS-1.10 | Postman 测试套件 | 1d | WBS-1.9 | AI | `tests/postman/collection.json` |
| WBS-1.11 | API 文档生成 | 1d | WBS-1.10 | AI | OpenAPI/Swagger 规范 |

**验收标准（DoD）**：
- [ ] 登录接口通过测试（正确凭证返回 token，错误凭证返回 401）
- [ ] Refresh Token 机制验证通过
- [ ] 客户 CRUD 所有接口单测覆盖 ≥ 80%
- [ ] Postman 测试套件全绿
- [ ] 限流机制生效（登录 5 次/15 分钟）

---

#### Phase 2：回访与订单模块（Day 22-28）

| 任务 ID | 任务名称 | 工作量 | 依赖 | 负责人 | 交付物 |
| --- | --- | --- | --- | --- | --- |
| WBS-2.1 | 回访 CRUD 接口 | 2d | WBS-1.11 | AI | `api/visits/*.ts` |
| WBS-2.2 | 回访关联客户与意向更新 | 1d | WBS-2.1 | AI | 业务逻辑实现 |
| WBS-2.3 | 产品订单 CRUD 接口 | 2d | WBS-1.11 | AI | `api/products/*.ts` |
| WBS-2.4 | 跟进日期自动计算 | 0.5d | WBS-2.3 | AI | `followUpDate` 逻辑 |
| WBS-2.5 | 产品统计接口 | 1d | WBS-2.4 | AI | `api/products/statistics.ts` |
| WBS-2.6 | 集成测试 | 1.5d | WBS-2.5 | AI | 客户→回访→订单流程测试 |

**验收标准（DoD）**：
- [ ] 回访创建时自动更新客户意向
- [ ] 产品创建时 `followUpDate` 默认为 `purchaseDate + 90天`
- [ ] 统计接口返回数据与数据库一致
- [ ] 集成测试覆盖完整业务流程

---

#### Phase 3：仪表盘与提醒（Day 29-35）

| 任务 ID | 任务名称 | 工作量 | 依赖 | 负责人 | 交付物 |
| --- | --- | --- | --- | --- | --- |
| WBS-3.1 | 仪表盘统计算法 | 2d | WBS-2.6 | AI | `getDashboardStatistics()` |
| WBS-3.2 | 提醒聚合算法 | 2d | WBS-3.1 | AI | `getImportantReminders()` |
| WBS-3.3 | 仪表盘接口 | 1d | WBS-3.2 | AI | `api/dashboard/statistics.ts` |
| WBS-3.4 | Vercel Cron 配置 | 0.5d | WBS-0.7 | AI | `vercel.json` cron 配置 |
| WBS-3.5 | 每日备份任务 | 1d | WBS-3.4 | AI | `api/cron/daily-backup.ts` |
| WBS-3.6 | 提醒算法测试 | 1.5d | WBS-3.3 | AI | 测试数据验证 |

**验收标准（DoD）**：
- [ ] 仪表盘统计数据准确（月度销售额、订单数、新增客户）
- [ ] 意向分布与数据库一致
- [ ] 提醒列表包含计划回访、产品回访、客户生日
- [ ] 提醒按日期升序排序
- [ ] Cron 任务日志正常记录

---

#### Phase 4：预设数据管理（Day 36-42）

| 任务 ID | 任务名称 | 工作量 | 依赖 | 负责人 | 交付物 |
| --- | --- | --- | --- | --- | --- |
| WBS-4.1 | 客户分类 CRUD | 0.5d | WBS-1.11 | AI | `api/presets/customer-categories.ts` |
| WBS-4.2 | 客户意向 CRUD | 0.5d | WBS-4.1 | AI | `api/presets/customer-intentions.ts` |
| WBS-4.3 | 地区/预算/联系人 CRUD | 1d | WBS-4.2 | AI | 多个预设接口 |
| WBS-4.4 | 回访方式/类型 CRUD | 0.5d | WBS-4.3 | AI | 预设接口 |
| WBS-4.5 | 导航模式/提醒周期 CRUD | 0.5d | WBS-4.4 | AI | 预设接口 |
| WBS-4.6 | 预设产品 CRUD | 0.5d | WBS-4.5 | AI | 预设接口 |
| WBS-4.7 | 通用排序接口 | 1d | WBS-4.6 | AI | `api/presets/reorder.ts` |
| WBS-4.8 | 预设数据测试 | 1.5d | WBS-4.7 | AI | 完整测试套件 |

**验收标准（DoD）**：
- [ ] 所有预设表 CRUD 接口通过测试
- [ ] 排序功能正确更新 `displayOrder`
- [ ] 前端可使用预设数据填充下拉框

---

#### Phase 5：用户设置与维护（Day 36-49）

| 任务 ID | 任务名称 | 工作量 | 依赖 | 负责人 | 交付物 |
| --- | --- | --- | --- | --- | --- |
| WBS-5.1 | 用户设置 CRUD | 1d | WBS-1.11 | AI | `api/settings/*.ts` |
| WBS-5.2 | 深色模式接口 | 0.5d | WBS-5.1 | AI | `api/settings/dark-mode.ts` |
| WBS-5.3 | 通知设置接口 | 0.5d | WBS-5.2 | AI | `api/settings/notification.ts` |
| WBS-5.4 | 备份接口 | 2d | WBS-3.5 | AI | `api/maintenance/backup.ts` |
| WBS-5.5 | 恢复接口 | 2d | WBS-5.4 | AI | `api/maintenance/restore.ts` |
| WBS-5.6 | 清空数据接口 | 1d | WBS-5.5 | AI | `api/maintenance/clear-data.ts` |
| WBS-5.7 | 操作日志审计 | 1d | WBS-5.6 | AI | 关键操作日志记录 |
| WBS-5.8 | 备份恢复测试 | 2d | WBS-5.7 | AI | 完整测试流程 |

**验收标准（DoD）**：
- [ ] 备份文件成功上传至云存储（Vercel Blob/R2）
- [ ] 恢复功能能还原数据（验证数据一致性）
- [ ] 清空数据不影响管理员登录与预设数据
- [ ] 操作日志记录完整（备份、恢复、清空、修改密码）

---

#### Phase 6：前端对接与优化（Day 43-56）

| 任务 ID | 任务名称 | 工作量 | 依赖 | 负责人 | 交付物 |
| --- | --- | --- | --- | --- | --- |
| WBS-6.1 | 前端目录结构 | 0.5d | WBS-0.7 | AI | `/app` 目录规划 |
| WBS-6.2 | API 封装客户端 | 1d | WBS-6.1 | AI | `app/src/api/client.js` |
| WBS-6.3 | 登录页 | 1d | WBS-6.2 | AI | `app/pages/login.html` |
| WBS-6.4 | 仪表盘页 | 2d | WBS-6.3 | AI | `app/pages/dashboard.html` + 图表 |
| WBS-6.5 | 客户列表页 | 1.5d | WBS-6.4 | AI | `app/pages/customer-list.html` |
| WBS-6.6 | 客户详情页 | 2d | WBS-6.5 | AI | `app/pages/customer-detail.html` |
| WBS-6.7 | 客户新增/编辑页 | 1.5d | WBS-6.6 | AI | `app/pages/customer-add.html` |
| WBS-6.8 | 回访记录页 | 1.5d | WBS-6.7 | AI | `app/pages/visit-records.html` |
| WBS-6.9 | 产品管理页 | 1.5d | WBS-6.8 | AI | `app/pages/product-management.html` |
| WBS-6.10 | 预设数据页 | 1d | WBS-6.9 | AI | `app/pages/preset-data.html` |
| WBS-6.11 | 用户设置页 | 1d | WBS-6.10 | AI | `app/pages/settings.html` |
| WBS-6.12 | 深色模式实现 | 1d | WBS-6.11 | AI | CSS 变量切换 |
| WBS-6.13 | 响应式适配 | 1.5d | WBS-6.12 | AI | Media Query 适配 |
| WBS-6.14 | E2E 测试脚本 | 2d | WBS-6.13 | AI | Playwright/Cypress 测试 |
| WBS-6.15 | Lighthouse 优化 | 1d | WBS-6.14 | AI | 性能、可访问性优化 |

**验收标准（DoD）**：
- [ ] 所有页面正常展示与交互
- [ ] API 对接无错误（401 自动刷新 token）
- [ ] 深色模式切换正常
- [ ] 响应式在 Mobile/Tablet/Desktop 正常
- [ ] E2E 测试通过核心路径
- [ ] Lighthouse 性能分数 ≥ 90

---

#### Phase 7：部署与发布（Day 50-56）

| 任务 ID | 任务名称 | 工作量 | 依赖 | 负责人 | 交付物 |
| --- | --- | --- | --- | --- | --- |
| WBS-7.1 | 生产环境配置 | 0.5d | WBS-6.15 | AI | Vercel 环境变量 |
| WBS-7.2 | 域名绑定 | 0.5d | WBS-7.1 | AI | 自定义域名配置 |
| WBS-7.3 | Sentry 集成 | 1d | WBS-7.2 | AI | 错误追踪配置 |
| WBS-7.4 | 日志监控配置 | 1d | WBS-7.3 | AI | Logtail/Axiom 集成 |
| WBS-7.5 | 部署自动化 | 1d | WBS-7.4 | AI | CI/CD Pipeline |
| WBS-7.6 | 部署文档 | 1d | WBS-7.5 | AI | 部署手册、回滚手册 |
| WBS-7.7 | API 文档发布 | 0.5d | WBS-7.6 | AI | Swagger UI 托管 |
| WBS-7.8 | 用户培训材料 | 1d | WBS-7.7 | AI | 用户操作手册、视频 |
| WBS-7.9 | 生产部署 | 0.5d | WBS-7.8 | AI | 正式上线 |
| WBS-7.10 | 7 天运行监测 | 7d | WBS-7.9 | AI | 日志审查、性能监控 |

**验收标准（DoD）**：
- [ ] 生产环境部署成功
- [ ] 域名访问正常
- [ ] Sentry 能捕获错误
- [ ] 日志正常收集
- [ ] 文档已同步更新
- [ ] 培训完成
- [ ] 生产运行 7 天无 P0/P1 缺陷

---

## 3. 质量保证计划

### 3.1 测试策略

| 测试类型 | 工具 | 覆盖范围 | 目标 | 执行时机 |
| --- | --- | --- | --- | --- |
| **单元测试** | Vitest | 工具函数、服务层、算法 | 覆盖率 ≥ 80% | 每次提交 |
| **接口测试** | Supertest + Vitest | 所有 API 端点 | 所有接口通过 | Phase 1-5 完成时 |
| **集成测试** | Supertest | 跨模块业务流程 | 核心路径无错误 | Phase 2-3 完成时 |
| **E2E 测试** | Playwright/Cypress | 用户核心路径 | 关键场景通过 | Phase 6 完成时 |
| **性能测试** | k6/Artillery | API 响应时间、限流 | 响应 < 500ms | Phase 7 部署前 |
| **安全测试** | 手工 + OWASP ZAP | JWT、SQL 注入、XSS | 无高危漏洞 | Phase 7 部署前 |
| **可访问性测试** | Lighthouse/axe | UI 页面 | WCAG AA 标准 | Phase 6 完成时 |

### 3.2 代码质量标准

| 指标 | 标准 | 检查工具 | 强制执行 |
| --- | --- | --- | --- |
| 代码规范 | ESLint 0 错误 | ESLint + Prettier | Git Pre-commit Hook |
| 类型安全 | TypeScript 0 错误 | tsc --noEmit | CI Pipeline |
| 测试覆盖率 | ≥ 80% | Vitest Coverage | CI Pipeline |
| 代码重复率 | < 5% | jscpd | Code Review |
| 安全漏洞 | 0 高危 | npm audit | CI Pipeline |
| 性能 Lint | 无性能反模式 | eslint-plugin-perf | Code Review |

### 3.3 代码评审流程

1. **提交规范**：遵循 Conventional Commits（如 `feat:`, `fix:`, `test:`）
2. **PR 模板**：
   - 变更描述
   - 关联任务（WBS-X.X）
   - 测试验证（单测/手动测试）
   - 截图/录屏（UI 变更）
3. **评审清单**：
   - [ ] 代码符合分层结构
   - [ ] 错误处理完整
   - [ ] 边界条件覆盖
   - [ ] 测试充分
   - [ ] 文档更新
4. **合并标准**：至少 1 名 Reviewer 批准，CI 全绿

---

## 4. 风险管理

### 4.1 风险识别与缓解

| 风险 ID | 风险描述 | 可能性 | 影响 | 缓解策略 | 应急预案 |
| --- | --- | --- | --- | --- | --- |
| R-01 | Serverless 冷启动延迟 | 高 | 中 | 减少依赖、复用 DB 连接 | 使用预热 Cron 任务 |
| R-02 | 数据库连接耗尽 | 中 | 高 | 使用连接池/Data Proxy | 监控连接数，设置告警 |
| R-03 | JWT Secret 泄露 | 低 | 高 | 强随机 Secret、限流 | 立即轮换 Secret |
| R-04 | 备份数据损坏 | 低 | 高 | 备份验证、冗余存储 | 保留多版本备份 |
| R-05 | 测试覆盖不足 | 中 | 中 | 强制覆盖率检查 | 增加回归测试 |
| R-06 | 前后端契约不一致 | 中 | 中 | OpenAPI 文档、契约测试 | 及时同步更新 |
| R-07 | 部署配置错误 | 中 | 高 | 预生产环境验证 | 回滚脚本 |
| R-08 | 性能不达标 | 低 | 中 | 提前性能测试、优化 | 缓存、CDN 加速 |

### 4.2 问题升级机制

| 严重级别 | 定义 | 响应时间 | 处理人 |
| --- | --- | --- | --- |
| P0（关键） | 系统不可用、数据丢失 | 立即 | Tech Lead + PM |
| P1（重要） | 核心功能不可用 | 4 小时内 | Tech Lead |
| P2（一般） | 部分功能异常 | 1 工作日内 | 开发工程师 |
| P3（轻微） | UI 问题、文档错误 | 3 工作日内 | 开发工程师 |

---

## 5. 验收方案

### 5.1 阶段验收清单

#### Phase 0 验收清单

- [ ] **环境启动**：`vercel dev` 启动无错误
- [ ] **健康检查**：`GET /api/health` 返回 200 + `{"status": "ok"}`
- [ ] **数据库连接**：Prisma Studio 可查看数据
- [ ] **种子数据**：管理员账户（admin/admin123）可登录
- [ ] **预设数据**：客户分类、意向等级等已插入
- [ ] **文档**：初始化文档（README、环境配置）完整

**验收方式**：现场演示 + 日志截图

---

#### Phase 1 验收清单

- [ ] **登录接口**：正确凭证返回 token，错误凭证返回 401
- [ ] **Token 刷新**：Refresh Token 机制验证通过
- [ ] **客户列表**：分页、搜索、过滤功能正常
- [ ] **客户 CRUD**：创建、读取、更新、删除全部通过
- [ ] **限流**：登录 5 次/15 分钟触发 429
- [ ] **单元测试**：认证与客户模块覆盖率 ≥ 80%
- [ ] **Postman 套件**：所有接口测试通过

**验收方式**：测试报告 + Postman 演示

---

#### Phase 2 验收清单

- [ ] **回访 CRUD**：创建、读取、更新、删除全部通过
- [ ] **意向更新**：回访记录中填写意向后，客户意向自动更新
- [ ] **产品 CRUD**：创建、读取、更新、删除全部通过
- [ ] **跟进日期**：产品创建时 `followUpDate` 默认为 `purchaseDate + 90天`
- [ ] **统计接口**：销售额、订单数、Top 产品数据正确
- [ ] **集成测试**：客户→回访→订单流程通过

**验收方式**：测试报告 + 数据截图

---

#### Phase 3 验收清单

- [ ] **仪表盘统计**：月度销售额、订单数、新增客户数据准确
- [ ] **意向分布**：与数据库实际分布一致
- [ ] **提醒列表**：包含计划回访、产品回访、客户生日
- [ ] **提醒排序**：按 `reminderDate` 升序排序
- [ ] **Cron 任务**：`daily-backup` 任务日志正常记录
- [ ] **算法测试**：提醒算法通过测试数据验证

**验收方式**：API 演示 + 日志审计

---

#### Phase 4 验收清单

- [ ] **预设 CRUD**：所有预设表（11 个）接口通过测试
- [ ] **排序功能**：`reorder` 接口正确更新 `displayOrder`
- [ ] **数据展示**：前端可使用预设数据填充下拉框
- [ ] **验证规则**：字段校验（name、displayOrder）生效

**验收方式**：接口测试报告 + 前端演示

---

#### Phase 5 验收清单

- [ ] **用户设置**：深色模式、通知开关正常保存与读取
- [ ] **备份功能**：备份文件成功上传至云存储
- [ ] **恢复功能**：恢复后数据与备份一致（验证关键表）
- [ ] **清空数据**：清空后业务数据删除，管理员与预设数据保留
- [ ] **操作日志**：备份、恢复、清空操作日志完整
- [ ] **安全校验**：敏感操作需二次确认

**验收方式**：功能演示 + 日志审计 + 数据对比

---

#### Phase 6 验收清单

- [ ] **页面完整性**：所有页面（登录、仪表盘、客户、回访、订单、预设、设置）实现
- [ ] **API 对接**：所有页面与 API 对接无错误
- [ ] **Token 刷新**：401 自动刷新 token 并重试请求
- [ ] **深色模式**：切换正常，CSS 变量正确应用
- [ ] **响应式**：在 Mobile/Tablet/Desktop 正常展示
- [ ] **E2E 测试**：核心路径（登录→客户→回访→订单→仪表盘）通过
- [ ] **Lighthouse**：性能、可访问性、最佳实践、SEO ≥ 90

**验收方式**：演示 + 测试报告 + Lighthouse 报告

---

#### Phase 7 验收清单

- [ ] **生产部署**：Vercel 部署成功，域名访问正常
- [ ] **监控配置**：Sentry 能捕获错误，日志正常收集
- [ ] **文档完整**：部署手册、回滚手册、API 文档、用户手册
- [ ] **培训完成**：用户操作培训材料与视频交付
- [ ] **性能验证**：API 响应时间 < 500ms（P95）
- [ ] **安全验证**：无高危漏洞（npm audit、OWASP ZAP）
- [ ] **运行稳定**：生产运行 7 天无 P0/P1 缺陷

**验收方式**：部署记录 + 运行日志 + 监控报告

---

### 5.2 最终验收流程

#### 5.2.1 验收准备（Day 50-52）
项目团队提交以下材料：

1. **技术文档**
   - [ ] 最终测试报告（单元/集成/E2E/性能）
   - [ ] 代码覆盖率报告
   - [ ] Lighthouse 报告
   - [ ] 安全审计报告

2. **运维文档**
   - [ ] 部署手册
   - [ ] 回滚手册
   - [ ] 监控与告警配置说明
   - [ ] 备份与恢复操作指南

3. **用户文档**
   - [ ] 用户操作手册
   - [ ] API 文档（Swagger/OpenAPI）
   - [ ] 培训视频

4. **交付物清单**
   - [ ] 源代码（GitHub Repository）
   - [ ] 环境配置文件（`.env.example`）
   - [ ] 数据库 Schema 与迁移文件
   - [ ] 种子数据脚本

#### 5.2.2 现场验收（Day 53-54）
与 PM 一起执行以下验收场景：

**场景 1：完整业务流程**
1. [ ] 登录系统（admin/admin123）
2. [ ] 查看仪表盘（统计数据、提醒列表）
3. [ ] 创建客户（填写完整信息）
4. [ ] 查看客户详情
5. [ ] 创建回访记录（验证意向更新）
6. [ ] 创建产品订单（验证跟进日期）
7. [ ] 返回仪表盘（验证数据更新）

**场景 2：预设数据管理**
1. [ ] 进入预设数据页面
2. [ ] 添加新客户分类
3. [ ] 拖拽排序（验证 displayOrder）
4. [ ] 删除预设数据
5. [ ] 在客户创建页验证下拉框更新

**场景 3：用户设置与维护**
1. [ ] 切换深色模式
2. [ ] 修改通知设置
3. [ ] 执行备份（验证云存储文件）
4. [ ] 清空测试数据
5. [ ] 恢复备份（验证数据一致性）
6. [ ] 重新登录（验证管理员保留）

**场景 4：移动端响应式**
1. [ ] 在移动设备/模拟器打开系统
2. [ ] 验证导航、表单、列表展示正常

**场景 5：性能与安全**
1. [ ] 检查 API 响应时间（Network Tab）
2. [ ] 验证限流（连续登录失败）
3. [ ] 检查 Sentry 错误日志
4. [ ] 查看 Vercel Logs

#### 5.2.3 试运行观察期（Day 55-61）
- **监控指标**：
  - [ ] API 可用性 ≥ 99.9%
  - [ ] P95 响应时间 < 500ms
  - [ ] 错误率 < 0.1%
  - [ ] 无 P0/P1 缺陷
  
- **日常检查**：
  - [ ] 每日审查错误日志
  - [ ] 每日执行核心业务流程
  - [ ] 每日验证 Cron 任务执行

#### 5.2.4 验收签署（Day 62）
- [ ] PM 确认所有验收标准通过
- [ ] 签署《项目验收报告》
- [ ] 归档所有交付物
- [ ] 项目正式关闭

---

### 5.3 验收标准汇总

| 维度 | 标准 | 验证方式 |
| --- | --- | --- |
| **功能完整性** | 所有模块（认证、客户、回访、订单、仪表盘、预设、设置）实现 | 功能演示 + 测试报告 |
| **API 质量** | 所有接口通过测试，响应格式符合契约 | Postman/Supertest 测试 |
| **代码质量** | 测试覆盖率 ≥ 80%，ESLint 0 错误 | Coverage 报告 + CI 日志 |
| **UI/UX** | 符合设计规范，响应式正常，Lighthouse ≥ 90 | 设计评审 + Lighthouse 报告 |
| **性能** | API P95 < 500ms，页面加载 < 3s | 性能测试报告 |
| **安全** | 无高危漏洞，JWT 验证、限流生效 | 安全审计报告 |
| **稳定性** | 生产运行 7 天无 P0/P1 缺陷 | 监控日志 + 缺陷跟踪 |
| **文档** | 部署、运维、用户文档完整 | 文档评审 |

---

## 6. 配置管理

### 6.1 环境配置

| 环境 | 用途 | 数据库 | 域名 | 部署方式 |
| --- | --- | --- | --- | --- |
| **Local** | 本地开发 | 本地 Postgres | localhost:3000 | `vercel dev` |
| **Preview** | PR 预览 | Vercel Postgres（测试） | `*.vercel.app` | 自动部署 |
| **Production** | 生产环境 | Vercel Postgres（生产） | `ai-crm.example.com` | `main` 分支自动部署 |

### 6.2 环境变量管理

**必需环境变量**：
```env
DATABASE_URL=postgresql://...
DIRECT_URL=postgresql://...
JWT_SECRET=<64+ chars random string>
JWT_REFRESH_SECRET=<64+ chars random string>
NODE_ENV=production
```

**可选环境变量**：
```env
SENTRY_DSN=https://...
LOGTAIL_SOURCE_TOKEN=...
VERCEL_BLOB_TOKEN=...
R2_ACCESS_KEY_ID=...
R2_SECRET_ACCESS_KEY=...
```

**配置方式**：
- Local：`.env.local`（不提交 Git）
- Preview/Production：Vercel Dashboard 配置

### 6.3 版本控制

- **分支策略**：
  - `main`：生产分支，保护分支，需 PR + Review
  - `develop`：开发分支（可选）
  - `feature/*`：功能分支
  - `hotfix/*`：紧急修复分支

- **提交规范**：Conventional Commits
  - `feat: 添加客户搜索功能`
  - `fix: 修复登录 token 过期问题`
  - `test: 增加仪表盘单元测试`
  - `docs: 更新部署文档`

- **版本标记**：使用 Git Tag 标记里程碑
  - `v0.1.0` - Phase 0 完成
  - `v0.5.0` - Phase 5 完成
  - `v1.0.0` - 正式发布

---

## 7. 沟通计划

### 7.1 定期会议

| 会议 | 频率 | 参与人 | 目的 | 时长 |
| --- | --- | --- | --- | --- |
| **每日站会** | 每日 | 团队全员 | 同步进度、识别阻碍 | 15 分钟 |
| **周度评审** | 每周 | 团队 + PM | 展示成果、验收 Phase | 1 小时 |
| **风险评估会** | 每 2 周 | Tech Lead + PM | 识别与缓解风险 | 30 分钟 |
| **最终验收会** | 项目结束 | 全体干系人 | 正式验收签署 | 2 小时 |

### 7.2 报告机制

| 报告类型 | 频率 | 内容 | 接收人 |
| --- | --- | --- | --- |
| **进度报告** | 每周 | 完成任务、进行中任务、风险 | PM |
| **测试报告** | 每 Phase | 测试结果、覆盖率、缺陷 | PM + Tech Lead |
| **部署报告** | 部署时 | 部署时间、版本、变更内容 | PM |
| **运行报告** | 试运行期间每日 | 错误日志、性能指标、用户反馈 | PM |

---

## 8. 参考文档

本计划基于以下项目文档制定：

| 文档 | 路径 | 用途 |
| --- | --- | --- |
| 项目概览 | `docs/technical/README.md` | 了解项目背景与目标 |
| 快速开始 | `docs/technical/00_快速开始指南.md` | 环境搭建与部署 |
| 需求规格 | `docs/technical/01_项目需求规格说明.md` | 功能需求与接口契约 |
| 架构设计 | `docs/technical/02_技术架构设计文档.md` | 技术栈与模块划分 |
| 业务规则 | `docs/technical/03_项目规则与AI算法.md` | 校验规则与算法逻辑 |
| UI 规范 | `docs/technical/04_UI设计与交互规范.md` | 界面设计与交互标准 |
| 任务规划 | `docs/technical/05_重新开发任务规划.md` | 阶段任务与 DoD |
| 最佳实践 | `docs/technical/06_开发建议与最佳实践.md` | 技术建议与质量标准 |

---

## 9. 附录

### 9.1 术语表

| 术语 | 定义 |
| --- | --- |
| DoD | Definition of Done，完成定义，阶段验收标准 |
| WBS | Work Breakdown Structure，工作分解结构 |
| P0/P1/P2/P3 | 缺陷优先级（关键/重要/一般/轻微） |
| Serverless | 无服务器架构，按需执行的函数计算 |
| ORM | Object-Relational Mapping，对象关系映射 |
| JWT | JSON Web Token，认证令牌 |
| E2E | End-to-End，端到端测试 |
| CI/CD | 持续集成/持续部署 |

### 9.2 联系方式

| 角色 | 姓名 | 联系方式 |
| --- | --- | --- |
| 项目经理 | PM（您） | [待填写] |
| 技术负责人 | AI Agent | [通过平台通信] |

---

## 📝 变更记录

| 版本 | 日期 | 变更内容 | 变更人 |
| --- | --- | --- | --- |
| 1.0 | 2024-11-06 | 初始版本，完整开发计划与验收方案 | AI Agent |

---

**项目委托人签字**：________________  
**日期**：________________

**技术负责人签字**：________________  
**日期**：________________
