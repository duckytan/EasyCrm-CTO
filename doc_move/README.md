# AI-CRM Serverless 重构蓝图

> 本仓库文档集旨在帮助 AI 智能体或自动化开发流水线完整复刻并轻量化改造现有的 AI-CRM 系统，使其能够以 Serverless 形态部署在 Vercel 或其它无服务器平台上。所有文档遵循模块化结构，便于 AI 快速解析、拆解与执行。

## 🎯 重构目标

- **100% 业务复刻**：保持原系统的客户管理、回访、订单、提醒、预设数据、仪表盘与设置等完整能力。
- **Serverless 化部署**：后端迁移为 Vercel Serverless Functions / Edge Functions，前端静态化并通过 Vercel 静态托管与 API 网关对接。
- **云原生数据层**：替换本地 SQLite，采用托管型 SQL 数据库（推荐 Vercel Postgres / Neon / Supabase Postgres）。
- **面向 AI 的工程规范**：提供机器可读且结构化的需求、架构、规则与任务拆解，支持自动化开发与测试。

## 📂 文档导航

| 文件 | 说明 |
| --- | --- |
| `README.md` | 项目概览、核心目标、文档索引与术语说明（当前文件） |
| `00_快速开始指南.md` | 本地开发与 Vercel 部署的端到端步骤 |
| `01_项目需求规格说明.md` | 详细业务需求、功能清单、接口契约、数据约束 |
| `02_技术架构设计文档.md` | Serverless 架构图、模块设计、技术栈与部署拓扑 |
| `03_项目规则与AI算法.md` | 编码规范、验证规则、提醒算法、仪表盘计算逻辑 |
| `04_UI设计与交互规范.md` | 页面信息架构、组件行为、响应式与无障碍要求 |
| `05_重新开发任务规划.md` | 阶段性任务拆解、任务依赖、交付里程碑 |
| `06_开发建议与最佳实践.md` | Serverless 优化建议、调试与测试策略、安全指引 |

## 🧭 快速理解现有业务域

### 主要业务模块
- **认证与安全**：管理员登录、JWT 访问令牌与刷新令牌、密码加密、速率限制。
- **客户全生命周期管理**：客户资料、层级联系人、画像字段、计划回访。
- **回访与提醒**：多类型回访记录、满意度、下一步跟进、提醒周期配置。
- **产品订单**：购买记录、金额、售后、自动生成跟进日期。
- **仪表盘与统计**：月度销售、订单、客户增长、意向分布、提醒聚合。
- **预设基础数据**：客户分类、意向等级、预算、地区、回访方式/类型等。
- **用户个性化设置**：深色模式、通知偏好、备份与恢复入口。

### 非功能需求摘要
- **安全性**：JWT + bcrypt、安全头、SQL/XSS 过滤、IP 黑/白名单、速率限制。
- **性能与可用性**：分页查询、索引、结构化日志、统一错误处理。
- **可维护性**：模块化路由、中间件、服务层，便于 Serverless 拆分。

## ☁️ Serverless 化的整体形态

- **前端**：保持原有静态 HTML/CSS/JS，托管于 Vercel 的静态资源层，可引入 Vite + SPA 方案作为可选升级。
- **后端**：`/api/*` 迁移为 Vercel Serverless Functions（Node.js 18+），通过轻量级适配层复用 Express 风格中间件。
- **数据库**：推荐使用托管 PostgreSQL；通过 Prisma / Drizzle / Kysely 进行类型安全的数据访问，保留原有表结构与索引需求。
- **认证**：JWT 仍由 Serverless Function 颁发，刷新逻辑通过专用函数处理；可扩展为 Edge Middleware 做会话校验。
- **日志与监控**：使用 Vercel 的内置日志；建议接入 Logtail 或 Axiom 以支持结构化日志和指标。

## 🤖 AI 协作约定

- 所有 YAML/JSON/Markdown 片段均采用明确的标题与表格，方便解析。
- 文档中出现的变量、环境名称、接口路径均与目标实现保持一致，AI 可直接映射到代码或配置。
- 任务规划提供依赖链与完成 Definition of Done (DoD) 判定标准，辅助自动化验收。
- 算法段落提供步骤描述与伪代码，方便 AI 自动生成实现。

## 📘 术语表

| 名称 | 解释 |
| --- | --- |
| Serverless Function | 在请求触发时按需执行的无服务器函数，按调用计费，无需维护基础设施 |
| Edge Function | 部署在边缘节点的函数，延迟更低，适合认证、重写等轻量逻辑 |
| Vercel KV / Postgres | Vercel 提供的托管键值存储与 PostgreSQL 数据库服务 |
| 预设数据 | 系统内置的枚举型配置，支持 CRUD 与排序，例如客户分类、回访方式等 |
| 跟进提醒 | 依据产品购买日期、计划回访日期、生日等生成的待办提示 |

---

> **使用方式**：从 `00_快速开始指南.md` 入手完成环境准备，再依次阅读需求、架构、规则、UI、任务与最佳实践文档，即可驱动 AI 或人工团队进行新一轮开发。
