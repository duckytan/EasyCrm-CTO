<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
  <meta name="theme-color" content="#2563eb">
  <title>系统设置 - AI-CRM 系统</title>
  <link rel="stylesheet" href="css/base.css">
  <script src="js/tiny-pinyin.min.js"></script>
  <script src="js/app.js"></script>
  <script src="js/navbar-loader.js"></script>
  <script defer src="https://cdn.jsdelivr.net/npm/alpinejs@3.13.3/dist/cdn.min.js"></script>
</head>
<body x-data="themeManager()" x-init="init()" data-page="settings">
  <div class="app-shell">
    <div id="navbar-container"></div>

    <div class="content-area">
      <header class="top-bar">
        <h1 class="top-bar__title">系统设置</h1>
        <div class="top-bar__actions">
          <button class="theme-toggle" @click="toggle()" type="button">
            <svg x-show="theme === 'light'" width="20" height="20" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"/>
            </svg>
            <svg x-show="theme === 'dark'" width="20" height="20" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <circle cx="12" cy="12" r="5"/>
              <line x1="12" y1="1" x2="12" y2="3"/>
              <line x1="12" y1="21" x2="12" y2="23"/>
              <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/>
              <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/>
              <line x1="1" y1="12" x2="3" y2="12"/>
              <line x1="21" y1="12" x2="23" y2="12"/>
              <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/>
              <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/>
            </svg>
          </button>
        </div>
      </header>

      <main class="page-content" x-data="{
        visitReminder: true,
        birthdayReminder: true,
        currentPassword: '',
        newPassword: '',
        confirmPassword: '',
        activePresetCategory: 'customer-categories',
        presetCategories: mockData.presetCategories,
        get currentPresetData() {
          switch(this.activePresetCategory) {
            case 'customer-categories': return mockData.customerCategories;
            case 'customer-intentions': return mockData.customerIntentions;
            case 'regions': return mockData.regions;
            case 'budget-ranges': return mockData.budgetRanges;
            case 'visit-methods': return mockData.visitMethods;
            case 'visit-types': return mockData.visitTypes;
            case 'preset-products': return mockData.presetProducts;
            default: return [];
          }
        },
        get currentPresetInfo() {
          return this.presetCategories.find(c => c.id === this.activePresetCategory) || {};
        }
      }">
        <!-- 账户信息 -->
        <section class="section">
          <h2 class="section-title">账户信息</h2>
          <div class="card">
            <div style="display: flex; align-items: center; gap: 16px;">
              <div class="avatar" style="width: 64px; height: 64px; font-size: 1.4rem;">AM</div>
              <div style="flex: 1;">
                <h3 style="margin: 0; font-size: 1.2rem; font-weight: 600;">admin</h3>
                <p style="margin: 6px 0 0; font-size: 0.9rem; color: var(--color-text-muted);">管理员账户</p>
                <p style="margin: 6px 0 0; font-size: 0.85rem; color: var(--color-text-muted);">
                  创建时间：2023-01-01  •  最后登录：2024-06-01
                </p>
              </div>
            </div>
          </div>
        </section>

        <!-- 外观设置 -->
        <section class="section">
          <h2 class="section-title">外观设置</h2>
          <div class="card">
            <div style="display: flex; justify-content: space-between; align-items: center; gap: 16px;">
              <div style="flex: 1;">
                <div style="font-weight: 600; margin-bottom: 6px; font-size: 1rem;">深色模式</div>
                <div style="font-size: 0.9rem; color: var(--color-text-muted);">切换深色/浅色主题，保护眼睛更舒适</div>
              </div>
              <label style="position: relative; display: inline-block; width: 56px; height: 32px; flex-shrink: 0;">
                <input 
                  type="checkbox" 
                  :checked="theme === 'dark'" 
                  @change="toggle()"
                  style="opacity: 0; width: 0; height: 0;"
                >
                <span style="position: absolute; cursor: pointer; inset: 0; background: var(--color-border); border-radius: 32px; transition: 0.3s;">
                  <span 
                    style="position: absolute; height: 26px; width: 26px; left: 3px; bottom: 3px; background-color: white; border-radius: 50%; transition: 0.3s;"
                    :style="theme === 'dark' ? 'transform: translateX(24px); background-color: #2563eb;' : ''"
                  ></span>
                </span>
              </label>
            </div>
          </div>
        </section>

        <!-- 通知设置 -->
        <section class="section">
          <h2 class="section-title">通知设置</h2>
          <div class="card" style="display: flex; flex-direction: column; gap: 20px;">
            <div style="display: flex; justify-content: space-between; align-items: center; gap: 16px;">
              <div style="flex: 1;">
                <div style="font-weight: 600; margin-bottom: 6px; font-size: 1rem;">回访提醒</div>
                <div style="font-size: 0.9rem; color: var(--color-text-muted);">到期回访自动提醒，不错过任何跟进机会</div>
              </div>
              <label style="position: relative; display: inline-block; width: 56px; height: 32px; flex-shrink: 0;">
                <input 
                  type="checkbox" 
                  x-model="visitReminder"
                  style="opacity: 0; width: 0; height: 0;"
                >
                <span style="position: absolute; cursor: pointer; inset: 0; background: var(--color-border); border-radius: 32px; transition: 0.3s;" :style="visitReminder ? 'background-color: #10b981;' : ''">
                  <span 
                    style="position: absolute; height: 26px; width: 26px; left: 3px; bottom: 3px; background-color: white; border-radius: 50%; transition: 0.3s;"
                    :style="visitReminder ? 'transform: translateX(24px);' : ''"
                  ></span>
                </span>
              </label>
            </div>

            <div style="display: flex; justify-content: space-between; align-items: center; gap: 16px;">
              <div style="flex: 1;">
                <div style="font-weight: 600; margin-bottom: 6px; font-size: 1rem;">生日提醒</div>
                <div style="font-size: 0.9rem; color: var(--color-text-muted);">客户生日自动提醒，维护良好客户关系</div>
              </div>
              <label style="position: relative; display: inline-block; width: 56px; height: 32px; flex-shrink: 0;">
                <input 
                  type="checkbox" 
                  x-model="birthdayReminder"
                  style="opacity: 0; width: 0; height: 0;"
                >
                <span style="position: absolute; cursor: pointer; inset: 0; background: var(--color-border); border-radius: 32px; transition: 0.3s;" :style="birthdayReminder ? 'background-color: #10b981;' : ''">
                  <span 
                    style="position: absolute; height: 26px; width: 26px; left: 3px; bottom: 3px; background-color: white; border-radius: 50%; transition: 0.3s;"
                    :style="birthdayReminder ? 'transform: translateX(24px);' : ''"
                  ></span>
                </span>
              </label>
            </div>
          </div>
        </section>

        <!-- 预设数据管理 -->
        <section class="section">
          <h2 class="section-title">预设数据管理</h2>
          <div class="card" style="background: rgba(37, 99, 235, 0.04); border-color: rgba(37, 99, 235, 0.12);">
            <div style="display: flex; gap: 12px; margin-bottom: 12px;">
              <svg width="22" height="22" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="flex-shrink: 0; color: var(--color-primary);">
                <circle cx="12" cy="12" r="10"/>
                <path d="M12 16v-4"/>
                <path d="M12 8h.01"/>
              </svg>
              <p style="margin: 0; font-size: 0.95rem; line-height: 1.6; color: var(--color-text-muted);">
                管理系统中的各类预设选项，便于快速录入和统一规范。预设数据用于客户、回访、订单等模块的快速选择，建议根据实际业务需求定期维护。
              </p>
            </div>
          </div>

          <!-- 预设分类选择 -->
          <div class="card" style="padding: 14px; margin-top: 16px;">
            <div style="display: flex; gap: 8px; flex-wrap: wrap;">
              <template x-for="cat in presetCategories" :key="cat.id">
                <button 
                  class="btn"
                  :class="activePresetCategory === cat.id ? '' : 'btn-ghost'"
                  @click="activePresetCategory = cat.id"
                  style="padding: 12px 18px; font-size: 0.9rem; border-radius: 16px;"
                >
                  <span x-text="cat.name"></span>
                </button>
              </template>
            </div>
          </div>

          <!-- 当前预设数据展示 -->
          <div class="card" style="margin-top: 16px;">
            <div style="display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 16px; gap: 12px; flex-wrap: wrap;">
              <div>
                <h3 class="section-title" style="margin: 0 0 6px 0;" x-text="currentPresetInfo.name"></h3>
                <p style="margin: 0; font-size: 0.9rem; color: var(--color-text-muted);" x-text="currentPresetInfo.description"></p>
              </div>
            </div>

            <!-- 客户分类 -->
            <div x-show="activePresetCategory === 'customer-categories'" x-transition>
              <div class="list">
                <template x-for="item in currentPresetData" :key="item.id">
                  <div class="card" style="background: var(--color-bg); padding: 16px;">
                    <div style="display: flex; justify-content: space-between; align-items: center; gap: 12px;">
                      <div style="flex: 1;">
                        <div style="font-weight: 600; font-size: 1rem; margin-bottom: 6px;" x-text="item.name"></div>
                        <div style="font-size: 0.9rem; color: var(--color-text-muted); margin-bottom: 8px;" x-text="item.description"></div>
                        <span class="tag tag-neutral" x-text="`使用次数: ${item.count}`"></span>
                      </div>
                      <div class="inline-actions" style="gap: 8px;">
                        <button class="btn btn-ghost" style="padding: 10px 16px; font-size: 0.875rem;" @click="showToast('编辑功能待实现', 'info')">编辑</button>
                      </div>
                    </div>
                  </div>
                </template>
              </div>
            </div>

            <!-- 意向等级 -->
            <div x-show="activePresetCategory === 'customer-intentions'" x-transition>
              <div class="list">
                <template x-for="item in currentPresetData" :key="item.id">
                  <div class="card" style="background: var(--color-bg); padding: 16px;">
                    <div style="display: flex; justify-content: space-between; align-items: center; gap: 12px;">
                      <div style="flex: 1; display: flex; align-items: center; gap: 12px;">
                        <div style="width: 14px; height: 14px; border-radius: 50%; flex-shrink: 0;" :style="`background: ${item.color};`"></div>
                        <div style="flex: 1;">
                          <div style="font-weight: 600; font-size: 1rem; margin-bottom: 6px;" x-text="item.name"></div>
                          <div style="font-size: 0.9rem; color: var(--color-text-muted); margin-bottom: 8px;" x-text="item.description"></div>
                          <span class="tag tag-neutral" x-text="`客户数: ${item.count}`"></span>
                        </div>
                      </div>
                      <div class="inline-actions" style="gap: 8px;">
                        <button class="btn btn-ghost" style="padding: 10px 16px; font-size: 0.875rem;" @click="showToast('编辑功能待实现', 'info')">编辑</button>
                      </div>
                    </div>
                  </div>
                </template>
              </div>
            </div>

            <!-- 地区管理 -->
            <div x-show="activePresetCategory === 'regions'" x-transition>
              <div class="list">
                <template x-for="item in currentPresetData" :key="item.id">
                  <div class="card" style="background: var(--color-bg); padding: 16px;">
                    <div style="display: flex; justify-content: space-between; align-items: center; gap: 12px;">
                      <div style="flex: 1;">
                        <div style="font-weight: 600; font-size: 1rem; margin-bottom: 6px;" x-text="item.name"></div>
                        <div style="font-size: 0.9rem; color: var(--color-text-muted); margin-bottom: 8px;" x-text="item.description"></div>
                        <span class="tag tag-neutral" x-text="`客户数: ${item.count}`"></span>
                      </div>
                      <div class="inline-actions" style="gap: 8px;">
                        <button class="btn btn-ghost" style="padding: 10px 16px; font-size: 0.875rem;" @click="showToast('编辑功能待实现', 'info')">编辑</button>
                      </div>
                    </div>
                  </div>
                </template>
              </div>
            </div>

            <!-- 预算范围 -->
            <div x-show="activePresetCategory === 'budget-ranges'" x-transition>
              <div class="list">
                <template x-for="item in currentPresetData" :key="item.id">
                  <div class="card" style="background: var(--color-bg); padding: 16px;">
                    <div style="display: flex; justify-content: space-between; align-items: center; gap: 12px;">
                      <div style="flex: 1;">
                        <div style="font-weight: 600; font-size: 1rem; margin-bottom: 6px;" x-text="item.name"></div>
                        <div style="font-size: 0.9rem; color: var(--color-text-muted); margin-bottom: 8px;" x-text="item.description"></div>
                        <span class="tag tag-neutral" x-text="`客户数: ${item.count}`"></span>
                      </div>
                      <div class="inline-actions" style="gap: 8px;">
                        <button class="btn btn-ghost" style="padding: 10px 16px; font-size: 0.875rem;" @click="showToast('编辑功能待实现', 'info')">编辑</button>
                      </div>
                    </div>
                  </div>
                </template>
              </div>
            </div>

            <!-- 回访方式 -->
            <div x-show="activePresetCategory === 'visit-methods'" x-transition>
              <div class="list">
                <template x-for="item in currentPresetData" :key="item.id">
                  <div class="card" style="background: var(--color-bg); padding: 16px;">
                    <div style="display: flex; justify-content: space-between; align-items: center; gap: 12px;">
                      <div style="flex: 1;">
                        <div style="font-weight: 600; font-size: 1rem; margin-bottom: 6px;" x-text="item.name"></div>
                        <div style="font-size: 0.9rem; color: var(--color-text-muted); margin-bottom: 8px;" x-text="item.description"></div>
                        <span class="tag tag-neutral" x-text="`使用次数: ${item.count}`"></span>
                      </div>
                      <div class="inline-actions" style="gap: 8px;">
                        <button class="btn btn-ghost" style="padding: 10px 16px; font-size: 0.875rem;" @click="showToast('编辑功能待实现', 'info')">编辑</button>
                      </div>
                    </div>
                  </div>
                </template>
              </div>
            </div>

            <!-- 回访类型 -->
            <div x-show="activePresetCategory === 'visit-types'" x-transition>
              <div class="list">
                <template x-for="item in currentPresetData" :key="item.id">
                  <div class="card" style="background: var(--color-bg); padding: 16px;">
                    <div style="display: flex; justify-content: space-between; align-items: center; gap: 12px;">
                      <div style="flex: 1;">
                        <div style="font-weight: 600; font-size: 1rem; margin-bottom: 6px;" x-text="item.name"></div>
                        <div style="font-size: 0.9rem; color: var(--color-text-muted); margin-bottom: 8px;" x-text="item.description"></div>
                        <span class="tag tag-neutral" x-text="`使用次数: ${item.count}`"></span>
                      </div>
                      <div class="inline-actions" style="gap: 8px;">
                        <button class="btn btn-ghost" style="padding: 10px 16px; font-size: 0.875rem;" @click="showToast('编辑功能待实现', 'info')">编辑</button>
                      </div>
                    </div>
                  </div>
                </template>
              </div>
            </div>

            <!-- 预设产品 -->
            <div x-show="activePresetCategory === 'preset-products'" x-transition>
              <div class="list">
                <template x-for="item in currentPresetData" :key="item.id">
                  <div class="card" style="background: var(--color-bg); padding: 16px;">
                    <div style="display: flex; justify-content: space-between; align-items: center; gap: 12px;">
                      <div style="flex: 1;">
                        <div style="font-weight: 600; font-size: 1rem; margin-bottom: 6px;" x-text="item.name"></div>
                        <div style="font-size: 0.9rem; color: var(--color-text-muted); margin-bottom: 8px;">
                          <span x-text="`产品编码: ${item.code}`"></span> · 
                          <span x-text="`类别: ${item.category}`"></span>
                        </div>
                        <span class="tag" x-text="formatCurrency(item.price)"></span>
                      </div>
                      <div class="inline-actions" style="gap: 8px;">
                        <button class="btn btn-ghost" style="padding: 10px 16px; font-size: 0.875rem;" @click="showToast('编辑功能待实现', 'info')">编辑</button>
                      </div>
                    </div>
                  </div>
                </template>
              </div>
            </div>
          </div>

          <!-- 新增按钮 - 固定在底部方便点击 -->
          <button class="btn" style="width: 100%; padding: 16px; font-size: 1rem; margin-top: 16px; border-radius: 16px;" @click="showToast('添加功能待实现', 'info')">
            <svg width="18" height="18" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <line x1="12" y1="5" x2="12" y2="19"/>
              <line x1="5" y1="12" x2="19" y2="12"/>
            </svg>
            新增 <span x-text="currentPresetInfo.name"></span>
          </button>
        </section>

        <!-- 修改密码 -->
        <section class="section">
          <h2 class="section-title">安全设置</h2>
          <div class="card">
            <form @submit.prevent="showToast('密码修改成功', 'success'); currentPassword = ''; newPassword = ''; confirmPassword = '';">
              <div class="field">
                <label class="field-label" for="current-pass">当前密码</label>
                <input 
                  id="current-pass"
                  type="password" 
                  class="input" 
                  placeholder="请输入当前密码" 
                  x-model="currentPassword"
                  style="padding: 14px 16px; font-size: 1rem;"
                  required
                >
              </div>

              <div class="field">
                <label class="field-label" for="new-pass">新密码</label>
                <input 
                  id="new-pass"
                  type="password" 
                  class="input" 
                  placeholder="请输入新密码（至少8位）" 
                  x-model="newPassword"
                  style="padding: 14px 16px; font-size: 1rem;"
                  minlength="8"
                  required
                >
              </div>

              <div class="field">
                <label class="field-label" for="confirm-pass">确认密码</label>
                <input 
                  id="confirm-pass"
                  type="password" 
                  class="input" 
                  placeholder="请再次输入新密码" 
                  x-model="confirmPassword"
                  style="padding: 14px 16px; font-size: 1rem;"
                  required
                >
              </div>

              <button type="submit" class="btn" style="width: 100%; margin-top: 24px; padding: 16px; font-size: 1rem; border-radius: 16px;">更新密码</button>
            </form>
          </div>
        </section>

        <!-- 数据管理 -->
        <section class="section">
          <h2 class="section-title">数据管理</h2>
          <div class="card" style="display: flex; flex-direction: column; gap: 18px;">
            <div style="display: flex; justify-content: space-between; align-items: flex-start; gap: 14px;">
              <div style="flex: 1;">
                <div style="font-weight: 600; margin-bottom: 6px; font-size: 1rem;">数据备份</div>
                <div style="font-size: 0.9rem; color: var(--color-text-muted);">备份客户、回访和订单数据，确保数据安全</div>
                <div style="margin-top: 8px; font-size: 0.85rem; color: var(--color-text-muted);">上次备份：2024-05-28</div>
              </div>
              <button class="btn btn-secondary" style="padding: 14px 20px; font-size: 0.95rem; border-radius: 14px; flex-shrink: 0;" @click="showToast('数据备份已创建', 'success')">
                <svg width="18" height="18" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                  <path d="M21 15v4a2 2 0 01-2 2H5a2 2 0 01-2-2v-4"/>
                  <polyline points="7 10 12 15 17 10"/>
                  <line x1="12" y1="15" x2="12" y2="3"/>
                </svg>
                创建备份
              </button>
            </div>

            <div style="height: 1px; background: var(--color-border);"></div>

            <div style="display: flex; justify-content: space-between; align-items: flex-start; gap: 14px;">
              <div style="flex: 1;">
                <div style="font-weight: 600; margin-bottom: 6px; font-size: 1rem;">恢复数据</div>
                <div style="font-size: 0.9rem; color: var(--color-text-muted);">从备份文件恢复数据，此操作将覆盖现有数据</div>
              </div>
              <button class="btn btn-ghost" style="padding: 14px 20px; font-size: 0.95rem; border-radius: 14px; flex-shrink: 0;" @click="if(confirm('确认恢复数据？此操作将覆盖现有数据')) { showToast('数据恢复完成', 'success'); }">
                <svg width="18" height="18" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                  <polyline points="23 4 23 10 17 10"/>
                  <path d="M20.49 15a9 9 0 11-2.12-9.36L23 10"/>
                </svg>
                恢复数据
              </button>
            </div>

            <div style="height: 1px; background: var(--color-border);"></div>

            <div style="display: flex; justify-content: space-between; align-items: flex-start; gap: 14px;">
              <div style="flex: 1;">
                <div style="font-weight: 600; margin-bottom: 6px; font-size: 1rem; color: #ef4444;">清空数据</div>
                <div style="font-size: 0.9rem; color: var(--color-text-muted);">删除所有业务数据，此操作不可恢复，请谨慎操作</div>
              </div>
              <button 
                class="btn" 
                style="padding: 14px 20px; font-size: 0.95rem; background: #ef4444; border-radius: 14px; flex-shrink: 0;" 
                @click="if(confirm('警告：此操作将删除所有客户、回访和订单数据，且不可恢复！\n\n确认继续？')) { if(confirm('请再次确认：确定要清空所有数据吗？')) { showToast('数据已清空', 'success'); } }"
              >
                <svg width="18" height="18" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                  <polyline points="3 6 5 6 21 6"/>
                  <path d="M19 6v14a2 2 0 01-2 2H7a2 2 0 01-2-2V6m3 0V4a2 2 0 012-2h4a2 2 0 012 2v2"/>
                </svg>
                清空数据
              </button>
            </div>
          </div>
        </section>

        <!-- 关于 -->
        <section class="section">
          <h2 class="section-title">关于系统</h2>
          <div class="card">
            <div style="display: flex; flex-direction: column; gap: 16px; font-size: 0.95rem;">
              <div style="display: flex; justify-content: space-between; align-items: center;">
                <span style="color: var(--color-text-muted);">系统版本</span>
                <span style="font-weight: 600;">v2.1.0</span>
              </div>
              <div style="display: flex; justify-content: space-between; align-items: center;">
                <span style="color: var(--color-text-muted);">发布日期</span>
                <span style="font-weight: 600;">2024-11-07</span>
              </div>
              <div style="display: flex; justify-content: space-between; align-items: center;">
                <span style="color: var(--color-text-muted);">技术栈</span>
                <span style="font-weight: 600;">Alpine.js + CSS3</span>
              </div>
              <div style="display: flex; justify-content: space-between; align-items: center;">
                <span style="color: var(--color-text-muted);">数据统计</span>
                <span style="font-weight: 600;">68 客户 · 28 回访 · 62 订单</span>
              </div>
            </div>
          </div>
        </section>

        <!-- 退出登录 - 固定大按钮便于点击 -->
        <section class="section">
          <button 
            class="btn btn-ghost" 
            style="width: 100%; border: 2px solid var(--color-border); padding: 18px; font-size: 1.05rem; border-radius: 16px;"
            @click="if(confirm('确认退出登录？')) { window.location.href = 'index.html'; }"
          >
            <svg width="20" height="20" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <path d="M9 21H5a2 2 0 01-2-2V5a2 2 0 012-2h4"/>
              <polyline points="16 17 21 12 16 7"/>
              <line x1="21" y1="12" x2="9" y2="12"/>
            </svg>
            退出登录
          </button>
        </section>
      </main>
    </div>
  </div>
</body>
</html>
